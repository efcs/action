
on: [ pull_request, pull_request_review  ]

permissions:
  checks: write
  statuses: write

jobs:
  run:
    runs-on: [ self-hosted ]
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - name: foobar
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: echo $GITHUB_CONTEXT | jq
    - run: git log --pretty=format:%ae | awk '/<pattern>/ && !line{line=$0} END{print line}'
    - name: Get PR Author Email Address
      run: |
        echo "The name of the pusher: ${{ github.event.pusher.name }}"
        echo "The email of the pusher: ${{ github.event.pusher.email }}"
    - run: |
        curl -L \
        -H "Accept: application/vnd.github+json" \
        -H "Authorization: $GITHUB_TOKEN" \
        -H "X-GitHub-Api-Version: 2022-11-28" \
        https://api.github.com/users/${{ github.actor }}
    - run: |
        curl -L \
        -H "Accept: application/vnd.github+json" \
        -H "Authorization: $GITHUB_TOKEN" \
        -H "X-GitHub-Api-Version: 2022-11-28" \
        ${{ github.event.pull_request._links.commits.href }}
    - run: ls -lart && pwd && ls -lart ../ && ls -lart ../../
    - run: git status
    - run: python3 ./get-email/main.py
  run-on-success:
    # Check if the PR has label libcxx-stage3-tests
    if: ${{ github.event_name == 'pull_request' && contains(github.event.pull_request.labels.*.name, 'libcxx-stage3-tests') }}
    needs: [ run ]
    runs-on: [ self-hosted ]
    steps:
      - run: |
          echo "The name of the pusher: ${{ github.event.pusher.name }}"
    

